<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

	<head>
		<meta charset="UTF-8" />
		<meta name="viewport"
			content="width=device-width, initial-scale=1.0" />

		<link th:rel="stylesheet"
			th:href="@{/webjars/bootstrap/5.1.3/css/bootstrap.min.css}" />
		<link rel="stylesheet"
			href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

		<link rel="stylesheet" th:href="@{/css/stili.css}">

		<title>Timer</title>
	</head>

	<body onload="timerstart()">
		<header>
			<!-- barra di navigazione -->
			<nav
				class="navbar navbar-expand-lg bg-dark navbar-dark">
				<div class="container">
					<img th:src="@{/img/task.png}"
						alt="task" width="50" />
					<div class="collapse navbar-collapse"
						id="navbarSupportedContent">
						<ul
							class="navbar-nav ms-auto mb-2 mb-lg-0">
							<li class="nav-item">
								<a class="nav-link active"
									aria-current="page"
									th:href="@{/dashboard}">Dashboard</a>
							</li>
							<li class="nav-item">
								<a class="nav-link active"
									aria-current="page"
									href="#">Servizi</a>
							</li>
							<li class="nav-item">
								<a class="nav-link active"
									href="#">Contatti</a>
							</li>
							<li class="nav-item">
								<a class="nav-link active"
									aria-current="page"
									href="#">Login</a>
							</li>
						</ul>
					</div>
				</div>
			</nav>
		</header>

		<div class="container text-center">
			<div class="row mt-lg-2">
				<div class="col mx-auto">
					<p>
						<!-- <h2 th:text="|Task: ${contatore.getTask().getId()}|"></h2> -->
					</p>
				</div>
			</div>
			<div class="container">
				<h1>The Time IS:</h1>
				<h1 id="timer">00:00:00</h1>

				<!-- <div th:if="${contatore.getFinaltime()} != null"> 
					<h1>Il contatore esiste</h1>
				</div> 				-->

			</div>

			<div class="container mt-5"
				style="width: 25rem;">
				<div class="row">
					<div class="col">
						<!-- <input type="hidden" th:field="*{task}" th:value="${task.getId()}"> -->
						<form class="mx-auto w-50 mb-4"
							th:action="@{|/start/${id}|}"
							th:object="${contatore}"
							method="post">
							<button type="submit"> start
							</button>
							<!-- <button th:data="${contatore}" th:onclick="avviaContatore(this.getAttribute('data'))">using data attribute</button> -->
						</form>
					</div>

					<div class="col">
						<form class="mx-auto w-50"
							th:action="@{|/Contatore/pause/${id}|}"
							th:object="${contatore}"
							method="post">
							<!-- <input type="hidden" th:field="*{task}" th:value="${task.id}">  -->
							<button type="submit"> pause
							</button>
						</form>
					</div>

					<div class="col">
						<form class="mx-auto w-50"
							th:action="@{|/Contatore/stop/${id}|}"
							th:object="${contatore}"
							method="post">
							<button type="submit"> stop
							</button>
						</form>
					</div>

					<div class="col">
						<form class="mx-auto w-50"
							th:action="@{|/Contatore/reset/${id}|}"
							th:object="${contatore}"
							method="post">
							<button type="submit"
								th:onclick="reset()"> reset
							</button>
						</form>
					</div>
				</div>
			</div>

		</div>

<script th:inline="javascript">
	/*<![CDATA[*/

	let finalTime = /*[[${finaltime}]]*/ null;
	let START = /*[[${start}]]*/ null;
	let RESTART = /*[[${restart}]]*/ null;
	let contatoreTrue = /*[[${contatoreIsTrue}]]*/ null; // boolean
	let contatoreIsRun = /*[[${contatoreIsRun}]]*/ null; // boolean
	let timenow = /*[[${timenow}]]*/ null;
	
	let hours = finalTime / 3600;
	let minutes = (finalTime % 3600) / 60;
	let seconds = finalTime % 60;
	
	const timerElement = document.querySelector("#timer");
				
	function tempochescorre() {
	
		seconds++;
		stampacontatore();
		
		if (seconds >= 60) {
			seconds = 0;
			minutes++;
		}
	
		if (minutes >= 60) {
			minutes = 0;
			hours++;
		}
		
	
	}
	
	function stampacontatore() {
	
		document.getElementById('timer').innerHTML = ('0' + Math.floor(hours)).slice(-2) + ":" + ('0' + Math.floor(minutes)).slice(-2) + ":" + ('0' + Math.floor(seconds)).slice(-2);
	
	}
	
	function timerstart() {
	
	
		if (contatoreTrue && contatoreIsRun) {
			setInterval(tempochescorre, 1000);
	
			console.log("isRun !!");
			console.log("finaltime is " + finalTime);
			console.log("ore " + hours + " minuti " + minutes + " secondi " + seconds)
			console.log("timenow is " + timenow)
	
		}
	
		else if (contatoreIsRun !== true) {

			stampacontatore();
			console.log("contatore non attivo , finaltime = " + finalTime);
		}
	
		else  {
		
			console.log("finaltime is not defined , finaltime = " + finalTime);
		}
	
	}
	
	/*]]>*/
</script>

<!-- <script th:src="@{/js/timer.js}"></script> -->

	</body>

</html>